<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Activity Tracker</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

</head>
<body>
    <div class="container">
      <div class="left">
        <div class="info-card">
            <img src="Activity.png" alt="Image">
            <div class="info-content">

            </div>
        </div>

        </div>
        <div class="right">
          <div class="search-container">
              <div class="dropdown"  >
                  <button class="dropbtn" >
                      <i class="fa-solid fa-arrow-down-short-wide"></i>
                  </button>
                  <div class="dropdown-content">
                      <a href="#" onclick="function_short('name-asc'); return false;">เรียงตามชื่อ (จาก A-Z)</a>
                      <a href="#" onclick="function_short('name-desc'); return false;">เรียงตามชื่อ (จาก Z-A)</a>
                  </div>
              </div>
              <input type="text" id="search" placeholder="ค้นหาชื่อกิจกรรม">
              <button type="button" id="search-button">ค้นหา</button>


          </div>
           <div class="activity-list-div">
             <ul id="activity-list" class="activity-list">




                 <!-- Add more activities as needed -->
             </ul>
           </div>

       </div>
    </div>
    <!-- Register Modal -->
    <div id="register-modal" class="modal">
        <div class="modal-content">
            <span class="close" id="close-register-modal">&times;</span>
            <h2>ลงชื่อเข้าใช้</h2>
            <form   id="registerForm">
               <div class="form-group">
                   <label for="first-name">ชื่อ</label>
                   <input type="text" id="first-name" name="first-name" required>
               </div>
               <div class="form-group">
                   <label for="last-name">นามสกุล</label>
                   <input type="text" id="last-name" name="last-name" required>
               </div>
               <div class="form-group">
                   <label for="phone">เบอร์โทร</label>
                   <input type="tel" id="phone" name="phone" required>
               </div>

               <button type="submit" class="btn">ลงทะเบียน</button>
           </form>
        </div>
    </div>
</body>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>

$(document).ready(function(){

  $.ajax({
       url: '/welcome-container',
       method: 'GET',
       success: function(Html) {
           $('.info-content').html(Html);
       }
   });
  $.ajax({
       url: '/api/activities',
       method: 'GET',
       success: function(data) {
           // รับข้อมูลจาก API
           const activities = data;
           let activitiesHtml = '';

           // ลูปผ่านข้อมูลและสร้าง HTML
           activities.forEach(activity => {
               activitiesHtml += `
                   <li data-name="${activity.ActivityName}">
                       <div class="activity-info">
                           <h3>${activity.ActivityName}</h3>
                           <p class="details">${activity.ActivityDes}</p>
                           <p class="seats-info">Total Seats: ${activity.ActivityRegisted} | Available Seats: ${activity.ActivitySum}</p>
                           <button class="view-btn">View</button>
                       </div>
                   </li>
               `;
           });

           // แสดงข้อมูลในหน้าเว็บ
           $('#activity-list').html(activitiesHtml);
       },
       error: function(xhr, status, error) {
           console.error('Error fetching activities:', status, error);
           $('#activities-container').html('<p>Error loading activities. Please try again later.</p>');
       }
   });

    // Handle Registration
    $('#registerForm').on('submit', function(event) {
         event.preventDefault();
         const firstName = $('#first-name').val();
         const lastName = $('#last-name').val();
         const phone = $('#phone').val();

         // Basic validation for registration
         if (!firstName || !lastName || !phone) {
           Swal.fire({
                 icon: 'warning',
                 title: 'Validation Error',
                 text: 'กรุณากรอกข้อมูลให้ครบทุกช่อง',
                 confirmButtonText: 'OK'
             });
             return;
         }

         // Validate phone number format (exactly 10 digits)
         const phoneRegex = /^[0-9]{10}$/;
         if (!phoneRegex.test(phone)) {

             Swal.fire({
                   icon: 'warning',
                   title: 'Invalid Phone Number',
                   text: 'โปรดป้อนหมายเลขโทรศัพท์ที่ถูกต้องซึ่งมี 10 หลักพอดี.',
                   confirmButtonText: 'OK'
               });
               return;
         }

         // Optionally, you can add more validation for password strength here

         $.ajax({
             url: '/api/register',
             method: 'POST',
             contentType: 'application/json',
             data: JSON.stringify({ firstName: firstName, lastName: lastName, phone: phone}),
             success: function(response) {
               Swal.fire({
                     icon: 'success',
                     title: 'การลงทะเบียนสำเร็จ',
                     text: 'คุณได้ลงทะเบียนสำเร็จแล้ว!',
                     confirmButtonText: 'OK'
                 });
                 function_user(firstName);
                 $('#register-modal').fadeOut();
             },
             error: function(xhr) {
                 Swal.fire({
                       icon: 'error',
                       title: 'Registration Failed',
                       text: xhr.responseJSON.message || 'Registration failed',
                       confirmButtonText: 'OK'
                   });
             }
         });
     });

    $('#search-button').on('click', function() {
       const searchTerm = $('#search').val().toLowerCase();
       $('#activity-list li').each(function() {
           const itemName = $(this).data('name').toLowerCase();
           if (itemName.includes(searchTerm)) {
               $(this).show();
           } else {
               $(this).hide();
           }
       });
    });


});
function function_short(order) {
  var $list = $('#activity-list');
  var $items = $list.children('li').get();

  $items.sort(function(a, b) {
      var textA = $(a).text().toUpperCase();
      var textB = $(b).text().toUpperCase();

      if (order === 'name-asc') {
          return textA.localeCompare(textB);
      } else if (order === 'name-desc') {
          return textB.localeCompare(textA);
      }
  });

  $.each($items, function(index, item) {
      $list.append(item);
  });
}
function function_user(firstName) {
  $.ajax({
       url: '/userinfo',
       method: 'GET',
       success: function(Html) {

           $('.info-content').html(Html);

       }
   });
}
function function_logout() {
  $.ajax({
       url: '/welcome-container',
       method: 'GET',
       success: function(Html) {
           $('.info-content').html(Html);
       }
   });
}
</script>

</html>
